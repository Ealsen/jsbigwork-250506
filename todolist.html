<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style/main.css">
    <title>© 2025 JavaScript大作业</title>
    <script src="script/index.js"></script>

    <style>
        .main-content {
            background-image: url(src/zbg-omoaWks3.gif);
            background-position: center;
        }

        .all {
            width: 90%;
            max-width: 1200px;
            margin: 50px auto;
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .all h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 36px;
            font-family: sans-serif;
            border-bottom: 2px solid #3498db;
            padding-bottom: 15px;
        }

        .inout {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .filter-buttons button {
            padding: 8px 16px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .filter-buttons button:hover {
            background: #e0e0e0;
        }

        .filter-buttons button.active {
            background: #3498db;
            color: white;
        }

        .inout #text {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #e1e8ed;
            border-radius: 5px;
            font-size: 16px;
            outline: none;
        }

        .inout button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .inout button:hover {
            background: #2980b9;
        }

        .list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .list ul li {
            background: rgba(255, 255, 255, 0.95);
            margin: 15px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e1e8ed;
            font-family: sans-serif;
            color: #2c3e50;
            position: relative;
        }

        .list ul li span {
            padding: 8px 15px;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            float: right;
            transition: opacity 0.3s;
        }

        .list ul li span:hover {
            opacity: 0.8;
        }

        .list ul li span.first {
            background: #27ae60;
        }

        .list ul li span.second {
            background: #e74c3c;
        }
    </style>

</head>

<body>
    <iframe id="personalFrame"
        style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; height: 85%; border: none; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; background: white; overflow: hidden;"></iframe>
    <div id="closeButton"
        style="display: none; position: fixed; top: calc(50% - 35% - 20px); right: calc(50% - 30% - 20px); cursor: pointer; background: #fff; border-radius: 50%; width: 30px; height: 30px; text-align: center; line-height: 30px; box-shadow: 0 2px 6px rgba(0,0,0,0.15); z-index: 1001;">
        ×</div>
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo-text" style="display: flex; align-items: center; cursor: pointer;"
                onclick="showPersonal()">
                <img src="src/logo.png" alt="logo">
                <h3>Ealsen</h3>
            </div>
        </div>
        <ul class="tree-menu" id="treeMenu">
            <li><a href="index.html">首页</a></li>
            <li>
                <a onclick="toggleSubmenu(this)">大作业基本功能</a>
                <ul class="submenu">
                    <li><a href="message.html">留言板</a></li>
                    <li><a href="./userForm.html">注册表单</a></li>
                </ul>
            </li>
            <li>
                <a onclick="toggleSubmenu(this)">扩展内容</a>
                <ul class="submenu">
                    <li><a href="./todolist.html">代办列表</a></li>
                    <li><a href="./calendar.html">日历</a></li>
                    <li><a href="./todysth.html">历史上的今天</a></li>
                </ul>
            </li>
            <li>
                <a onclick="toggleSubmenu(this)">更多</a>
                <ul class="submenu">
                    <li><a href="./callme.html">联系我</a></li>
                    <li><a href="./about.html">关于</a></li>
                </ul>
            </li>
            <li>
                <a onclick="toggleSubmenu(this)">状态码页</a>
                <ul class="submenu">
                    <li>
                        <a onclick="toggleSubmenu(this)">结果页</a>
                        <ul class="submenu">
                            <li><a href="./200.html">200</a></li>
                            <li><a href="./201.html">201</a></li>
                        </ul>
                    </li>
                    <li>
                        <a onclick="toggleSubmenu(this)">异常页</a>
                        <ul class="submenu">
                            <li><a href="./404.html">404</a></li>
                            <li><a href="./403.html">403</a></li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="sidebar-footer">
            <p><a href="https://github.com/Ealsen" style="text-decoration: none;color: aliceblue;">© 2025
                    JavaScript大作业</a></p>
        </div>
    </div>



    <div class="main-content">
        <div class="all">
            <h2>待办事项工具</h2>
            <div class="inout">
                <input type="text" name="item" id="text" placeholder="添加您的事项">
                <button>添加</button>
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">全部</button>
                <button class="filter-btn" data-filter="completed">已完成</button>
                <button class="filter-btn" data-filter="uncompleted">未完成</button>
            </div>
            <div class="list">
                <ul>
                </ul>
            </div>
        </div>
    </div>


    <script>
        const input = document.getElementById('text');
        const btn = document.querySelector('button');
        const ul = document.querySelector('.list ul');
        const STORAGE_KEY = 'todoList';

        // 从localStorage加载数据
        function loadTodos() {
            const todos = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            todos.forEach(todo => {
                const liItems = createListItem(todo.text);
                if (todo.completed) {
                    liItems.classList.add('completed');
                    liItems.style.background = 'green';
                    liItems.style.color = 'white';
                    liItems.querySelector('.first').textContent = '未完成';
                }
                ul.appendChild(liItems);
            });
        }

        // 保存待办事项列表到 localStorage
        function saveTodos() {
            const todos = []; // 创建一个空数组用于存储待办事项
            ul.querySelectorAll('li').forEach(li => { // 遍历所有的 li 元素
                if (li.style.display !== 'none') { // 如果 li 元素没有被隐藏
                    todos.push({ // 将该事项推入数组
                        text: li.childNodes[0].textContent.trim(), // 获取事项文本内容并去除首尾空格
                        completed: li.classList.contains('completed') // 检查该事项是否已完成
                    });
                }
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(todos)); // 将数组转换为 JSON 字符串，并保存到 localStorage
        }

        // 页面加载时恢复数据
        window.addEventListener('load', loadTodos);

        btn.onclick = function () {
            const val = input.value.trim(); // 去除前后空格
            if (val === '') { // 判断输入是否为空
                alert('请输入待办事项');
                return;
            }

            const liItems = createListItem(val); // 创建li元素
            ul.appendChild(liItems); // 将li元素添加到ul中
            saveTodos(); // 保存到localStorage

            input.value = ''; // 清空输入框
        };

        /**
         * 创建一个包含文本内容和两个操作按钮（完成、删除）的 li 元素
         * @param {string} text - 待办事项的文本内容
         * @returns {HTMLElement} 返回创建好的 li 元素，包含文本和操作按钮
         */
        function createListItem(text) {
            const liItems = document.createElement('li'); // 创建 li 元素作为待办事项的容器
            liItems.textContent = text; // 设置 li 的文本内容为传入的待办事项文本

            const spanOne = createSpan('完成', 'first'); // 创建“完成”按钮 span 元素
            const spanTwo = createSpan('删除', 'second'); // 创建“删除”按钮 span 元素

            liItems.appendChild(spanOne); // 将“完成”按钮添加到 li 中
            liItems.appendChild(spanTwo); // 将“删除”按钮添加到 li 中

            return liItems; // 返回构建好的 li 元素
        }

        /**
         * 创建一个带有指定文本和类名的 span 元素
         * @param {string} text - span 元素显示的文本内容
         * @param {string} className - span 元素的类名，用于样式控制
         * @returns {HTMLElement} 返回创建好的 span 元素
         */
        function createSpan(text, className) {
            // 创建一个新的 span 元素
            const span = document.createElement('span');
            // 设置 span 的文本内容
            span.textContent = text;
            // 为 span 添加指定的类名
            span.className = className;
            // 返回创建好的 span 元素
            return span;
        }

        // 筛选功能：根据已完成、未完成或全部进行筛选
        const filterButtons = document.querySelectorAll('.filter-btn'); // 获取所有筛选按钮
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                // 更新按钮状态：移除所有按钮的 active 类，给当前点击的按钮添加 active 类
                filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                // 获取筛选类型（all/completed/uncompleted）
                const filterType = button.dataset.filter;
                const items = ul.querySelectorAll('li'); // 获取所有的待办事项 li 元素

                // 遍历每个待办事项，根据筛选条件设置显示或隐藏
                items.forEach(item => {
                    const isCompleted = item.classList.contains('completed'); // 判断是否已完成
                    if (filterType === 'all') {
                        item.style.display = ''; // 显示所有事项
                    } else if (filterType === 'completed') {
                        item.style.display = isCompleted ? '' : 'none'; // 显示已完成的事项
                    } else if (filterType === 'uncompleted') {
                        item.style.display = !isCompleted ? '' : 'none'; // 显示未完成的事项
                    }
                });
            });
        });

        // 使用事件委托处理动态生成的元素上的点击事件
        ul.addEventListener('click', function (event) {
            const target = event.target; // 获取点击的目标元素
            if (target.tagName === 'SPAN') { // 判断点击的元素是否是 span
                if (target.classList.contains('first')) { // 如果是“完成/未完成”按钮
                    const parentLi = target.parentNode; // 获取父级 li 元素
                    parentLi.classList.toggle('completed'); // 切换 completed 类名

                    // 根据状态更新背景色、文字颜色和按钮文本
                    if (parentLi.classList.contains('completed')) {
                        parentLi.style.background = 'green';
                        parentLi.style.color = 'white';
                        target.textContent = '未完成';
                    } else {
                        parentLi.style.background = '';
                        parentLi.style.color = '';
                        target.textContent = '完成';
                    }
                } else if (target.classList.contains('second')) { // 如果是“删除”按钮
                    target.parentNode.style.display = 'none'; // 隐藏该事项
                    saveTodos(); // 删除后保存最新状态到 localStorage
                }

                saveTodos(); // 当任务状态改变时保存数据
            }
        });
    </script>

</body>

</html>